
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../RM_Training/">
      
      
        <link rel="next" href="../MCTS_DPO/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>群组相对策略优化 GRPO - AIDIY Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#grpo" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AIDIY Wiki" class="md-header__button md-logo" aria-label="AIDIY Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AIDIY Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              群组相对策略优化 GRPO
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  首页 Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Mathematical_Foundation/Linear_Algebra/Matrix_Decomposition/Full_Rank_Decomposition/" class="md-tabs__link">
          
  
  数学基础 Mathematical Foundation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ML_Pages/CNN/" class="md-tabs__link">
          
  
  经典机器学习 Classic ML

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../LLM_Pages/LLM_Architecture/LLM_Architecture/" class="md-tabs__link">
          
  
  大语言模型结构 LLM Structure

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../SFT_Pages/SFT/" class="md-tabs__link">
          
  
  指令微调 SFT

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Engineering_Pages/LlamaFactory/" class="md-tabs__link">
          
  
  框架实践 Framework

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../DPO/" class="md-tabs__link">
          
  
  人类反馈强化学习 RLHF

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AIDIY Wiki" class="md-nav__button md-logo" aria-label="AIDIY Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AIDIY Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页 Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数学基础 Mathematical Foundation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            数学基础 Mathematical Foundation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mathematical_Foundation/Linear_Algebra/Matrix_Decomposition/Full_Rank_Decomposition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    矩阵满秩分解 Full Rank Decomposition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mathematical_Foundation/Linear_Algebra/Matrix_Calculation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    矩阵求导 Matrix Calculation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mathematical_Foundation/Manifold/Manifold_hypothesis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    流形假设 Manifold Hypothesis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    经典机器学习 Classic ML
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            经典机器学习 Classic ML
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/CNN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    卷积神经网络 CNN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/MLP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多层感知机 MLP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/RNN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    循环神经网络 RNN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/VAE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    变分自编码器 VAE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/Pytorch_CNN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CNN编程练习 CNN Practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/Pytorch_MLP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MLP编程练习 MLP Practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/Pytorch_RNN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RNN编程练习 RNN Practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ML_Pages/Pytorch_VAE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VAE编程练习 VAE Practice
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    大语言模型结构 LLM Structure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            大语言模型结构 LLM Structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Transformer架构 Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Transformer架构 Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/LLM_Architecture/LLM_Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformer经典架构 Classical Architecture
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    归一化 Normalization
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            归一化 Normalization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/Normalization/LayerNorm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    层归一化 LayerNorm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/Normalization/BatchNorm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    批归一化 BatchNorm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/Normalization/RMSNorm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    均方根归一化 RMSNorm
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/Positional_Embedding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    位置编码 Positional Embedding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/Pre-Train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    预训练阶段 Pre-Train
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/Post-Train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    后训练阶段 Post-Train
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LLM_Pages/MoE_Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MoE数学架构 Mathematics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    指令微调 SFT
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            指令微调 SFT
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SFT_Pages/SFT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    监督微调 SFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SFT_Pages/Lora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    低秩适应 Lora
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    框架实践 Framework
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            框架实践 Framework
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Engineering_Pages/LlamaFactory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LlamaFactory入门 Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Engineering_Pages/Full_SFT_LlamaFactory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    全量微调 Full SFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Engineering_Pages/Pytorch/Basic_1_Tensor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch张量 Tensor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Engineering_Pages/Pytorch/Basic_2_Autograd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch自动微分 Autograd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Engineering_Pages/Pytorch/How_to_Load_Data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch数据加载 Data Loading
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Engineering_Pages/Pytorch/How_to_Train_Model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch模型训练 Model Training
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    人类反馈强化学习 RLHF
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            人类反馈强化学习 RLHF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DPO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    直接偏好优化 DPO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DPO_Exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DPO编程练习 DPO Practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DPO_Problem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DPO问题分析 Problems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DPO_Math/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DPO数学原理 Mathematics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PPO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    近端策略优化 PPO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PPO_Loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PPO损失函数 Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RM_Full_FT_or_Lora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    奖励模型训练方式 RM Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RM_Training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    奖励模型训练 RM Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    群组相对策略优化 GRPO
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    群组相对策略优化 GRPO
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#grpo" class="md-nav__link">
    <span class="md-ellipsis">
      GRPO的损失函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRPO的损失函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的推导过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的优化机制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grpo_1" class="md-nav__link">
    <span class="md-ellipsis">
      GRPO的流程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRPO的流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 输入参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-t" class="md-nav__link">
    <span class="md-ellipsis">
      3. 迭代更新（重复 \(T\) 次）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 迭代更新（重复 \(T\) 次）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a" class="md-nav__link">
    <span class="md-ellipsis">
      a. 复制当前群组权重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    <span class="md-ellipsis">
      b. 采样群组和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      c. 更新群组权重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      d. 归一化群组权重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    <span class="md-ellipsis">
      e. 更新策略参数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 返回最终策略
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的梯度推导
    </span>
  </a>
  
    <nav class="md-nav" aria-label="损失函数的梯度推导">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      加权梯度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的具体梯度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      梯度的直观解释
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MCTS_DPO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    蒙特卡洛树DPO MCTS-DPO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../KTO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KL约束优化 KTO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimPO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    简单偏好优化 SimPO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimPO_Exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SimPO编程练习 SimPO Practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RM_Exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    奖励模型练习 RM Practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NPO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    负偏好优化 NPO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FPO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    特征偏好优化 FPO
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#grpo" class="md-nav__link">
    <span class="md-ellipsis">
      GRPO的损失函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRPO的损失函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的推导过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的优化机制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grpo_1" class="md-nav__link">
    <span class="md-ellipsis">
      GRPO的流程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRPO的流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 输入参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-t" class="md-nav__link">
    <span class="md-ellipsis">
      3. 迭代更新（重复 \(T\) 次）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 迭代更新（重复 \(T\) 次）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a" class="md-nav__link">
    <span class="md-ellipsis">
      a. 复制当前群组权重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    <span class="md-ellipsis">
      b. 采样群组和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      c. 更新群组权重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      d. 归一化群组权重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    <span class="md-ellipsis">
      e. 更新策略参数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 返回最终策略
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的梯度推导
    </span>
  </a>
  
    <nav class="md-nav" aria-label="损失函数的梯度推导">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      加权梯度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      损失函数的具体梯度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      梯度的直观解释
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>群组相对策略优化 GRPO</h1>

<p><a href="https://github.com/InuyashaYang/JoinAI"><img alt="GitHub stars" src="https://img.shields.io/github/stars/InuyashaYang/JoinAI?style=social" /></a></p>
<h2 id="grpo">GRPO的损失函数<a class="headerlink" href="#grpo" title="Permanent link">&para;</a></h2>
<h3 id="_1">损失函数的定义<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>GRPO 旨在优化策略在不同群组上的表现，使其在最不利的群组上也能保持良好的性能。为此，GRPO 将优化问题建模为一个 <strong>最小-最大优化问题</strong>，其损失函数定义为：</p>
<p><span class="arithmatex">\(\min_{\theta \in \Theta} \max_{\alpha \in \Delta_K} \sum_{g=1}^{K} \alpha_g \cdot \mathcal{L}_{\text{DPO}}(\pi_{\theta}, \mathcal{T}_g)\)</span></p>
<p>其中：</p>
<ul>
<li>
<p><span class="arithmatex">\(\theta \in \Theta \subset \mathbb{R}^d\)</span> 是策略 <span class="arithmatex">\(\pi_{\theta}\)</span> 的参数，<span class="arithmatex">\(\Theta\)</span> 是参数的可行空间。</p>
</li>
<li>
<p><span class="arithmatex">\(\alpha = (\alpha_1, \alpha_2, \dots, \alpha_K) \in \Delta_K\)</span> 是群组权重向量，<span class="arithmatex">\(\Delta_K\)</span> 为 <span class="arithmatex">\(K\)</span> 维单纯形：</p>
</li>
</ul>
<p><span class="arithmatex">\(\Delta_K = \left\{ \alpha \in \mathbb{R}^K \ \bigg| \ \alpha_g \geq 0 \ \forall g \in \{1, \dots, K\}, \ \sum_{g=1}^{K} \alpha_g = 1 \right\}\)</span></p>
<ul>
<li><span class="arithmatex">\(\mathcal{L}_{\text{DPO}}(\pi_{\theta}, \mathcal{T}_g)\)</span> 是策略 <span class="arithmatex">\(\pi_{\theta}\)</span> 在群组 <span class="arithmatex">\(g\)</span> 上的 <strong>DPO 损失</strong>，具体定义为：</li>
</ul>
<p><span class="arithmatex">\(\mathcal{L}_{\text{DPO}}(\pi_{\theta}; (x_g, y_w, y_l)) = \log\left( \sigma\left( \beta h_{\pi_{\theta}}(x_g, y_w, y_l) \right) \right)\)</span></p>
<p>其中：</p>
<ul>
<li><span class="arithmatex">\(\sigma\)</span> 是 Sigmoid 函数。</li>
<li><span class="arithmatex">\(\beta\)</span> 是一个超参数，用于控制函数的陡峭程度。</li>
<li><span class="arithmatex">\(h_{\pi_{\theta}}(x_g, y_w, y_l)\)</span> 是策略对样本 <span class="arithmatex">\((x_g, y_w, y_l)\)</span> 的评分函数。</li>
</ul>
<h3 id="_2">损失函数的推导过程<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>GRPO 的损失函数源于以下几点考虑：</p>
<ol>
<li><strong>群组鲁棒性</strong>：希望策略在所有群组上表现均衡，尤其是在表现较差的群组上提升其性能。</li>
<li><strong>最坏情况优化</strong>：通过最小化在最不利群组上的损失，确保策略在任何群组上都不会有较大损失。</li>
<li><strong>加权优化</strong>：引入群组权重 <span class="arithmatex">\(\alpha\)</span>，动态调整各群组的权重，使得表现较差的群组获得更高的权重，从而在优化过程中得到更多关注。</li>
</ol>
<p>具体推导步骤如下：</p>
<ol>
<li><strong>定义优化目标</strong>：</li>
</ol>
<p>我们希望找到一个策略参数 <span class="arithmatex">\(\theta\)</span>，使得在所有群组上的最大损失最小。数学表达为：</p>
<p><span class="arithmatex">\(\min_{\theta \in \Theta} \max_{g \in \{1, \dots, K\}} \mathcal{L}_{\text{DPO}}(\pi_{\theta}, \mathcal{T}_g)\)</span></p>
<ol>
<li><strong>引入群组权重 <span class="arithmatex">\(\alpha\)</span></strong>：</li>
</ol>
<p>为了将多个群组的损失统一考虑，引入权重向量 <span class="arithmatex">\(\alpha\)</span>，其中每个 <span class="arithmatex">\(\alpha_g\)</span> 表示群组 <span class="arithmatex">\(g\)</span> 的重要性。优化目标转化为加权损失的最大化：</p>
<p><span class="arithmatex">\(\min_{\theta \in \Theta} \max_{\alpha \in \Delta_K} \sum_{g=1}^{K} \alpha_g \cdot \mathcal{L}_{\text{DPO}}(\pi_{\theta}, \mathcal{T}_g)\)</span></p>
<ol>
<li><strong>解释加权损失</strong>：</li>
</ol>
<p>通过调整权重 <span class="arithmatex">\(\alpha\)</span>，优化过程能够自适应地关注那些在当前策略下表现较差的群组。具体来说：
   - 若某群组 <span class="arithmatex">\(g\)</span> 的损失较高，优化过程中 <span class="arithmatex">\(\alpha_g\)</span> 会增加，促使策略参数 <span class="arithmatex">\(\theta\)</span> 更关注该群组的损失优化。
   - 由于 <span class="arithmatex">\(\alpha\)</span> 受到单纯形约束（权重和为1），因此总损失在各群组间平衡。</p>
<ol>
<li><strong>DPO损失的设计</strong>：</li>
</ol>
<p>DPO（Distributionally Robust Policy Optimization）损失函数设计为：</p>
<p><span class="arithmatex">\(\mathcal{L}_{\text{DPO}}(\pi_{\theta}; (x_g, y_w, y_l)) = \log\left( \sigma\left( \beta \left[ r_{\theta}(x_g, y_w) - r_{\theta}(x_g, y_l) \right] \right) \right)\)</span></p>
<p>其中：
   - <span class="arithmatex">\(r_{\theta}(x, y)\)</span> 表示策略 <span class="arithmatex">\(\pi_{\theta}\)</span> 在输入 <span class="arithmatex">\(x\)</span> 下对响应 <span class="arithmatex">\(y\)</span> 的评分。
   - <span class="arithmatex">\(\beta\)</span> 控制函数的敏感度，使得评分差异更为明显时，损失变化更剧烈。</p>
<p>该设计的目的是鼓励策略在正确响应 <span class="arithmatex">\(y_w\)</span> 上的评分高于错误响应 <span class="arithmatex">\(y_l\)</span>，通过 Sigmoid 函数平滑地衡量这种差异。</p>
<h3 id="_3">损失函数的优化机制<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>在损失函数的优化过程中，GRPO 采用 <strong>交替优化</strong> 的方式，即在每一轮迭代中，交替更新策略参数 <span class="arithmatex">\(\theta\)</span> 和群组权重 <span class="arithmatex">\(\alpha\)</span>：</p>
<ol>
<li><strong>固定策略参数 <span class="arithmatex">\(\theta\)</span>，优化群组权重 <span class="arithmatex">\(\alpha\)</span></strong>：</li>
<li>
<p>通过最大化加权损失，确定当前策略下最需要关注的群组。</p>
</li>
<li>
<p><strong>固定群组权重 <span class="arithmatex">\(\alpha\)</span>，优化策略参数 <span class="arithmatex">\(\theta\)</span></strong>：</p>
</li>
<li>通过最小化加权损失，优化策略在重点关注的群组上的表现。</li>
</ol>
<p>这种交替优化的机制确保了策略在每一轮迭代中既能关注当前表现较差的群组，又能整体上提升所有群组的性能。</p>
<h2 id="grpo_1">GRPO的流程<a class="headerlink" href="#grpo_1" title="Permanent link">&para;</a></h2>
<p>在理解了 GRPO 的损失函数及其优化机制后，接下来介绍 GRPO 的具体流程步骤。</p>
<h3 id="1">1. 初始化<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>步长参数</strong>：</p>
</li>
<li>
<p>群组权重更新步长 <span class="arithmatex">\(\eta_{\alpha}\)</span>。</p>
</li>
<li>
<p>策略参数更新步长 <span class="arithmatex">\(\eta_{\theta}\)</span>。</p>
</li>
<li>
<p><strong>初始权重</strong>：</p>
</li>
<li>
<p>策略的初始参数 <span class="arithmatex">\(\theta^{(0)}\)</span>。</p>
</li>
<li>
<p>每个群组的初始权重 <span class="arithmatex">\(\alpha^{(0)}\)</span>（通常初始化为均匀分布，即 <span class="arithmatex">\(\alpha_g^{(0)} = \frac{1}{K}\)</span>）。</p>
</li>
<li>
<p><strong>投影算子</strong>：</p>
</li>
<li>
<p><span class="arithmatex">\(\mathrm{P}_{\Theta}\)</span>，用于确保更新后的 <span class="arithmatex">\(\theta\)</span> 仍在参数空间 <span class="arithmatex">\(\Theta\)</span> 内。</p>
</li>
</ul>
<h3 id="2">2. 输入参数<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>数据集</strong>：</p>
</li>
<li>
<p><span class="arithmatex">\(\mathcal{T}\)</span>，总样本数量为 <span class="arithmatex">\(N = |\mathcal{T}|\)</span>。</p>
</li>
<li>
<p>数据集被划分为 <span class="arithmatex">\(K\)</span> 个群组，每个群组的大小为 <span class="arithmatex">\(N_g\)</span>，其中 <span class="arithmatex">\(g \in \{1, 2, \dots, K\}\)</span>。</p>
</li>
<li>
<p><strong>损失函数</strong>：</p>
</li>
<li>
<p><span class="arithmatex">\(l(\pi_{\theta}; \cdot)\)</span>，用于评估策略的表现，这里指的是 DPO 损失。</p>
</li>
</ul>
<h3 id="3-t">3. 迭代更新（重复 <span class="arithmatex">\(T\)</span> 次）<a class="headerlink" href="#3-t" title="Permanent link">&para;</a></h3>
<p>对每一轮迭代 <span class="arithmatex">\(t = 1, \dots, T\)</span>，执行以下步骤：</p>
<h4 id="a">a. 复制当前群组权重<a class="headerlink" href="#a" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\(\alpha' \leftarrow \alpha^{(t-1)}\)</span></p>
<ul>
<li>创建一个临时的群组权重向量 <span class="arithmatex">\(\alpha'\)</span>，用于在当前迭代中更新。</li>
</ul>
<h4 id="b">b. 采样群组和数据<a class="headerlink" href="#b" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>采样群组</strong>：</li>
</ul>
<p>从群组分布 <span class="arithmatex">\(\mathrm{Categorical}\left(\frac{N_1}{N}, \frac{N_2}{N}, \dots, \frac{N_K}{N}\right)\)</span> 中采样一个群组 <span class="arithmatex">\(g\)</span>。这里，群组的采样概率与其在数据集中所占的比例成正比。</p>
<ul>
<li><strong>采样数据点</strong>：</li>
</ul>
<p>从群组 <span class="arithmatex">\(g\)</span> 的数据集中采样一个数据点 <span class="arithmatex">\((x_g, y_w, y_l) \sim \mathcal{T}_g\)</span>，其中：</p>
<ul>
<li><span class="arithmatex">\(x_g\)</span> 是输入特征。</li>
<li><span class="arithmatex">\(y_w\)</span> 是“赢”（正确）的响应标签。</li>
<li><span class="arithmatex">\(y_l\)</span> 是“输”（错误）的响应标签。</li>
</ul>
<h4 id="c">c. 更新群组权重<a class="headerlink" href="#c" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\(\alpha'_g \leftarrow \alpha'_g \exp\left( \eta_{\alpha} \cdot \frac{N \cdot l(\pi_{\theta^{(t-1)}}; (x_g, y_w, y_l))}{N_g} \right)\)</span></p>
<ul>
<li><strong>指数加权</strong>：</li>
</ul>
<p>根据当前策略 <span class="arithmatex">\(\pi_{\theta^{(t-1)}}\)</span> 在群组 <span class="arithmatex">\(g\)</span> 上的损失 <span class="arithmatex">\(l(\pi_{\theta^{(t-1)}}; (x_g, y_w, y_l))\)</span>，对群组权重 <span class="arithmatex">\(\alpha'_g\)</span> 进行指数加权更新。</p>
<ul>
<li><strong>归一化因子</strong>：</li>
</ul>
<p>因子 <span class="arithmatex">\(\frac{N}{N_g}\)</span> 用于归一化，确保群组大小对权重更新有适当影响，避免群组大小差异过大对优化过程产生不均衡影响。</p>
<h4 id="d">d. 归一化群组权重<a class="headerlink" href="#d" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\(\alpha^{(t)} \leftarrow \frac{\alpha'}{\sum_{g'} \alpha'_{g'}}\)</span></p>
<ul>
<li>将更新后的群组权重 <span class="arithmatex">\(\alpha'\)</span> 进行归一化，使得 <span class="arithmatex">\(\alpha^{(t)}\)</span> 成为一个位于单纯形 <span class="arithmatex">\(\Delta_K\)</span> 上的向量（即 <span class="arithmatex">\(\sum_{g} \alpha_g^{(t)} = 1\)</span>）。</li>
<li>归一化确保群组权重在每一轮迭代后保持有效的概率分布。</li>
</ul>
<h4 id="e">e. 更新策略参数<a class="headerlink" href="#e" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\(\theta^{(t)} \leftarrow \mathrm{P}_{\Theta} \left( \theta^{(t-1)} - \eta_{\theta} \cdot \frac{N \alpha_g^{(t)} \nabla_{\theta} l(\pi_{\theta^{(t-1)}}; (x_g, y_w, y_l))}{N_g} \right)\)</span></p>
<ul>
<li><strong>加权梯度下降</strong>：</li>
</ul>
<p>使用加权后的梯度 <span class="arithmatex">\(\alpha_g^{(t)} \nabla_{\theta} l(\pi_{\theta^{(t-1)}}; (x_g, y_w, y_l))\)</span> 对策略参数 <span class="arithmatex">\(\theta\)</span> 进行更新。</p>
<ul>
<li><strong>权重的作用</strong>：</li>
</ul>
<p>权重 <span class="arithmatex">\(\alpha_g^{(t)}\)</span> 保证了在当前策略下表现较差的群组在策略更新时被给予更多关注。</p>
<ul>
<li><strong>归一化因子</strong>：</li>
</ul>
<p>因子 <span class="arithmatex">\(\frac{N}{N_g}\)</span> 再次确保群组大小对更新的影响适度，避免小群组因样本量少而被忽视。</p>
<ul>
<li><strong>投影算子</strong>：</li>
</ul>
<p>通过 <span class="arithmatex">\(\mathrm{P}_{\Theta}\)</span>，确保更新后的策略参数 <span class="arithmatex">\(\theta^{(t)}\)</span> 仍然位于参数空间 <span class="arithmatex">\(\Theta\)</span> 内。</p>
<h3 id="4">4. 返回最终策略<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<p><span class="arithmatex">\(\textbf{Return:} \quad \pi(\theta^{(T)})\)</span></p>
<ul>
<li>在完成 <span class="arithmatex">\(T\)</span> 轮迭代后，输出最终优化得到的策略 <span class="arithmatex">\(\pi(\theta^{(T)})\)</span>。</li>
</ul>
<h2 id="_4">损失函数的梯度推导<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>为了更清晰地理解策略参数更新的机制，以下对损失函数的梯度进行详细推导。</p>
<h3 id="_5">加权梯度<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>策略参数更新的关键在于对加权后的梯度进行下降优化：</p>
<p><span class="arithmatex">\(\theta^{(t)} \leftarrow \mathrm{P}_{\Theta} \left( \theta^{(t-1)} - \eta_{\theta} \cdot \frac{N \alpha_g^{(t)} \nabla_{\theta} l(\pi_{\theta^{(t-1)}}; (x_g, y_w, y_l))}{N_g} \right)\)</span></p>
<p>其中，加权梯度为：</p>
<p><span class="arithmatex">\(\alpha_g^{(t)} \nabla_{\theta} l(\pi_{\theta^{(t-1)}}; (x_g, y_w, y_l))\)</span></p>
<h3 id="_6">损失函数的具体梯度<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>根据 DPO 损失函数的定义：</p>
<p><span class="arithmatex">\(\mathcal{L}_{\text{DPO}}(\pi_{\theta}; (x_g, y_w, y_l)) = \log\left( \sigma\left( \beta \left[ r_{\theta}(x_g, y_w) - r_{\theta}(x_g, y_l) \right] \right) \right)\)</span></p>
<p>对 <span class="arithmatex">\(\theta\)</span> 求梯度：</p>
<p><span class="arithmatex">\(\nabla_{\theta} \mathcal{L}_{\text{DPO}}(\pi_{\theta}; (x_g, y_w, y_l)) = \sigma\left( \beta \left[ r_{\theta}(x_g, y_w) - r_{\theta}(x_g, y_l) \right] \right) \cdot \beta \cdot \left[ \nabla_{\theta} r_{\theta}(x_g, y_w) - \nabla_{\theta} r_{\theta}(x_g, y_l) \right]\)</span></p>
<p>结合权重 <span class="arithmatex">\(\alpha_g^{(t)}\)</span>，加权梯度为：</p>
<p><span class="arithmatex">\(\alpha_g^{(t)} \nabla_{\theta} \mathcal{L}_{\text{DPO}}(\pi_{\theta}; (x_g, y_w, y_l)) = \alpha_g^{(t)} \cdot \sigma\left( \beta \left[ r_{\theta}(x_g, y_w) - r_{\theta}(x_g, y_l) \right] \right) \cdot \beta \cdot \left[ \nabla_{\theta} r_{\theta}(x_g, y_w) - \nabla_{\theta} r_{\theta}(x_g, y_l) \right]\)</span></p>
<h3 id="_7">梯度的直观解释<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Sigmoid函数 <span class="arithmatex">\(\sigma\)</span> 的作用</strong>：</li>
</ul>
<p><span class="arithmatex">\(\sigma\left( \beta \left[ r_{\theta}(x_g, y_w) - r_{\theta}(x_g, y_l) \right] \right)\)</span> 衡量了当前策略在群组 <span class="arithmatex">\(g\)</span> 上对正确响应 <span class="arithmatex">\(y_w\)</span> 和错误响应 <span class="arithmatex">\(y_l\)</span> 的评分差异。越大的差异意味着策略在该样本上的表现越好，损失越低。</p>
<ul>
<li><strong>权重 <span class="arithmatex">\(\alpha_g^{(t)}\)</span> 的调节</strong>：</li>
</ul>
<p>当某群组的损失较高时，<span class="arithmatex">\(\alpha_g^{(t)}\)</span> 增大，促使梯度更新时更多地关注该群组的样本，从而优化策略在该群组上的表现。</p>
<ul>
<li><strong>梯度方向</strong>：</li>
</ul>
<p>梯度 <span class="arithmatex">\(\left[ \nabla_{\theta} r_{\theta}(x_g, y_w) - \nabla_{\theta} r_{\theta}(x_g, y_l) \right]\)</span> 表示增加对正确响应 <span class="arithmatex">\(y_w\)</span> 的评分，同时减少对错误响应 <span class="arithmatex">\(y_l\)</span> 的评分。这有助于策略更准确地做出正确决策。</p>
<h2 id="_8">总结<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>GRPO 通过构建一个最小-最大优化的损失函数，结合加权梯度下降和群组权重动态调整机制，实现了策略在不同群组上的鲁棒性优化。其核心优势体现在：</p>
<ol>
<li><strong>群组鲁棒性</strong>：确保策略在所有群组上都有良好的表现，尤其是在表现较差的群组上有针对性的提升。</li>
<li><strong>自适应加权</strong>：通过动态调整群组权重，使得优化过程能自适应地聚焦于当前最需要改进的群组。</li>
<li><strong>梯度优化</strong>：通过精心设计的损失函数和梯度更新机制，确保策略参数向着最优方向快速收敛。</li>
<li><strong>理论保障</strong>：在一定的假设条件下（如损失函数的凸性和 Lipschitz 连续性），GRPO 的优化过程能够保证以 <span class="arithmatex">\(\mathcal{O}(T^{-1/2})\)</span> 的速率收敛到最优解。</li>
</ol>
<iframe src="/AIDIY/RLHF_Pages/GRPO_viz.html" width="100%" height="600px" style="border: 1px solid #ccc;" title="GRPO Interactive Content">
    您的浏览器不支持 iframe，无法加载交互式内容。
    请 <a href="/AIDIY/RLHF_Pages/GRPO_viz.html" target="_blank">点击这里在新窗口中查看</a>。
</iframe>

<script src="https://giscus.app/client.js"
        data-repo="InuyashaYang/AIDIY"
        data-repo-id="R_kgDOM1VVTQ"
        data-category="Announcements"
        data-category-id="DIC_kwDOM1VVTc4Ckls_"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Joining-AI/LLM_Interview_Prepare" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.sections", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../javascripts/mathjax_config.js"></script>
      
    
  </body>
</html>