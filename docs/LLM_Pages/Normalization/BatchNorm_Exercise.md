### 练习题 1: 批归一化（BatchNorm）的计算

**问题：**

给定以下输入矩阵 $X$，其中每一列代表一个特征，每一行代表一个样本：

$$
X = \begin{bmatrix}
2.0 & 4.0 & 6.0 \\
8.0 & 10.0 & 12.0 \\
14.0 & 16.0 & 18.0
\end{bmatrix}
$$

假设缩放参数 $\gamma = [1, 1, 1]$，平移参数 $\beta = [0, 0, 0]$，且 $\epsilon = 1 \times 10^{-5}$。

计算应用批归一化（BatchNorm）后的输出矩阵 $Y$。

<details>
<summary>提示</summary>

**步骤 1: 计算每个特征的批次均值 ($\mu$)**

对于每个特征列计算均值：

$$
\mu = \left[ \frac{2 + 8 + 14}{3}, \frac{4 + 10 + 16}{3}, \frac{6 + 12 + 18}{3} \right] = [8.0, 10.0, 12.0]
$$

**步骤 2: 计算每个特征的批次方差 ($\sigma^2$)**

对于每个特征列计算方差：

$$
\sigma^2 = \left[ \frac{(2 - 8)^2 + (8 - 8)^2 + (14 - 8)^2}{3}, \frac{(4 - 10)^2 + (10 - 10)^2 + (16 - 10)^2}{3}, \frac{(6 - 12)^2 + (12 - 12)^2 + (18 - 12)^2}{3} \right]
$$

计算具体数值：

$$
\sigma^2 = \left[ \frac{36 + 0 + 36}{3}, \frac{36 + 0 + 36}{3}, \frac{36 + 0 + 36}{3} \right] = [24.0, 24.0, 24.0]
$$

**步骤 3: 计算每个特征的标准差 ($\sigma$)**

$$
\sigma = \sqrt{\sigma^2 + \epsilon} = \sqrt{24.0 + 1 \times 10^{-5}} \approx 4.8990
$$

**步骤 4: 进行归一化**

对于每个元素 $x_{ij}$，计算归一化值 $\hat{x}_{ij}$：

$$
\hat{x}_{ij} = \frac{x_{ij} - \mu_j}{\sigma_j}
$$

具体计算：

- 第一列：
  - $\hat{x}_{11} = \frac{2 - 8}{4.8990} \approx -1.2247$
  - $\hat{x}_{21} = \frac{8 - 8}{4.8990} = 0.0$
  - $\hat{x}_{31} = \frac{14 - 8}{4.8990} \approx 1.2247$
  
- 第二列：
  - $\hat{x}_{12} = \frac{4 - 10}{4.8990} \approx -1.2247$
  - $\hat{x}_{22} = \frac{10 - 10}{4.8990} = 0.0$
  - $\hat{x}_{32} = \frac{16 - 10}{4.8990} \approx 1.2247$
  
- 第三列：
  - $\hat{x}_{13} = \frac{6 - 12}{4.8990} \approx -1.2247$
  - $\hat{x}_{23} = \frac{12 - 12}{4.8990} = 0.0$
  - $\hat{x}_{33} = \frac{18 - 12}{4.8990} \approx 1.2247$

**步骤 5: 应用缩放和平移**

$$
y_{ij} = \gamma_j \cdot \hat{x}_{ij} + \beta_j = 1 \cdot \hat{x}_{ij} + 0 = \hat{x}_{ij}
$$

因此，最终输出矩阵 $Y$ 为：

$$
Y \approx \begin{bmatrix}
-1.2247 & -1.2247 & -1.2247 \\
0.0 & 0.0 & 0.0 \\
1.2247 & 1.2247 & 1.2247
\end{bmatrix}
$$

---
### 练习题 2: 不同参数下的批归一化

**问题：**

给定以下输入矩阵 $X$，其中每一列代表一个特征，每一行代表一个样本：

$$
X = \begin{bmatrix}
3.0 & 6.0 \\
9.0 & 12.0 \\
15.0 & 18.0 \\
21.0 & 24.0
\end{bmatrix}
$$

假设缩放参数 $\gamma = [2, 0.5]$，平移参数 $\beta = [1, -1]$，且 $\epsilon = 1 \times 10^{-5}$。

计算应用批归一化（BatchNorm）后的输出矩阵 $Y$。

<details>
<summary>提示</summary>

**步骤 1: 计算每个特征的批次均值 ($\mu$)**

对于每个特征列计算均值：

$$
\mu = \left[ \frac{3 + 9 + 15 + 21}{4}, \frac{6 + 12 + 18 + 24}{4} \right] = [12.0, 15.0]
$$

**步骤 2: 计算每个特征的批次方差 ($\sigma^2$)**

对于每个特征列计算方差：

$$
\sigma^2 = \left[ \frac{(3 - 12)^2 + (9 - 12)^2 + (15 - 12)^2 + (21 - 12)^2}{4}, \frac{(6 - 15)^2 + (12 - 15)^2 + (18 - 15)^2 + (24 - 15)^2}{4} \right]
$$

计算具体数值：

$$
\sigma^2 = \left[ \frac{81 + 9 + 9 + 81}{4}, \frac{81 + 9 + 9 + 81}{4} \right] = [45.0, 45.0]
$$

**步骤 3: 计算每个特征的标准差 ($\sigma$)**

$$
\sigma = \sqrt{\sigma^2 + \epsilon} = \sqrt{45.0 + 1 \times 10^{-5}} \approx 6.7082
$$

**步骤 4: 进行归一化**

对于每个元素 $x_{ij}$，计算归一化值 $\hat{x}_{ij}$：

$$
\hat{x}_{ij} = \frac{x_{ij} - \mu_j}{\sigma_j}
$$

具体计算：

- 第一列：
  - $\hat{x}_{11} = \frac{3 - 12}{6.7082} \approx -1.3416$
  - $\hat{x}_{21} = \frac{9 - 12}{6.7082} \approx -0.4472$
  - $\hat{x}_{31} = \frac{15 - 12}{6.7082} \approx 0.4472$
  - $\hat{x}_{41} = \frac{21 - 12}{6.7082} \approx 1.3416$
  
- 第二列：
  - $\hat{x}_{12} = \frac{6 - 15}{6.7082} \approx -1.3416$
  - $\hat{x}_{22} = \frac{12 - 15}{6.7082} \approx -0.4472$
  - $\hat{x}_{32} = \frac{18 - 15}{6.7082} \approx 0.4472$
  - $\hat{x}_{42} = \frac{24 - 15}{6.7082} \approx 1.3416$

**步骤 5: 应用缩放和平移**

$$
y_{ij} = \gamma_j \cdot \hat{x}_{ij} + \beta_j
$$

具体计算：

- 第一列 ($\gamma_1 = 2$, $\beta_1 = 1$):
  - $y_{11} = 2 \cdot (-1.3416) + 1 \approx -1.6832$
  - $y_{21} = 2 \cdot (-0.4472) + 1 \approx 0.1056$
  - $y_{31} = 2 \cdot 0.4472 + 1 \approx 1.8944$
  - $y_{41} = 2 \cdot 1.3416 + 1 \approx 3.6832$
  
- 第二列 ($\gamma_2 = 0.5$, $\beta_2 = -1$):
  - $y_{12} = 0.5 \cdot (-1.3416) - 1 \approx -1.6708$
  - $y_{22} = 0.5 \cdot (-0.4472) - 1 \approx -1.2236$
  - $y_{32} = 0.5 \cdot 0.4472 - 1 \approx -0.7764$
  - $y_{42} = 0.5 \cdot 1.3416 - 1 \approx -0.3292$

因此，最终输出矩阵 $Y$ 为：

$$
Y \approx \begin{bmatrix}
-1.6832 & -1.6708 \\
0.1056 & -1.2236 \\
1.8944 & -0.7764 \\
3.6832 & -0.3292
\end{bmatrix}
$$

